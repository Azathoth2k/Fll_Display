<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>{{title}}</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/normalize.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.dataTables.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <script src="{{ url_for('static', filename='js/libs/jquery-1.11.1.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/libs/bootstrap.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/libs/moment.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/libs/jquery.dataTables.js') }}"></script>
        <script src="{{ url_for('static', filename='js/libs/dataTables.bootstrap.js') }}"></script>
        <script type="text/javascript">
            $(document).ready(function () { 
                // Initialize the DataTable component
                var myTable = $('#teamsTable').DataTable({
                    "searching": false,
                    "ordering":  false,
                    "lengthChange": false,
                    "ajax": {
                        "url": "/api/teams",
                        "dataSrc": "",
                        "error": function() {
                            alert("Unable to get data from server");   
                        }
                    },
                    "columns": [
                        { "data": "number" },
                        { "data": "name" },
                        { "data": "affiliation" },
                        { "data": "round1" },
                        { "data": "round2" },
                        { "data": "round3" }
                    ]                    
                });
                
                // Set up the page looping
                var page = 1;
                var pageCount = myTable.page.info().pages;
                
                // Auto-advance through the datatable pages
                var page_advance = setInterval(function() {
                    
                    // If on the final page, reload the data then start again
                    if(page >= pageCount) {
                        console.log("reloading data");
                        myTable.ajax.reload();
                        myTable.page(0).draw(false);    
                        pageCount = myTable.page.info().pages;
                        page = 0;    
                    }
                    
                    // Set the table page and redraw
                    myTable.page(page).draw(false);
                    page++;
                }, 5000);
            });
        </script>
    </head>
    <body>
        <div class="container-fluid">
            <h2 class="text-center">{{title}}</h2>    
            <div class="page-header">
                <div id="teams">
                    <table class="table table-striped" id="teamsTable">
                        <thead>
                            <th>Number</th>
                            <th>Name</th>
                            <th>Affiliation</th>
                            <th>Round 1</th>
                            <th>Round 2</th>
                            <th>Round 3</th>
                            <th>Best</th>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </body>
</html>
